<div class="contezza-material-table">
    <div class="contezza-material-table-container">
        <ng-container *ngIf="!loading && _dataSource; else loadingResults">
            <ng-container *ngIf="_dataSource?.data?.length; else noResults">
                <table mat-table [dataSource]="_dataSource" multiTemplateDataRows>
                    <ng-container *ngFor="let column of columns">
                        <ng-container matColumnDef="{{ column.name }}">
                            <th mat-header-cell *matHeaderCellDef class="contezza-material-table-container-column">
                                <span>{{ column.displayName | translate }}</span>
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <ng-container [ngSwitch]="column.type">
                                    <ng-container *ngSwitchCase="'icon'">
                                        <adf-icon [value]="column.value"></adf-icon>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'component'">
                                        <adf-dynamic-component
                                            [data]="getElementData(element, columns, actions, _dataSource.filteredData)"
                                            [id]="column.component"
                                        ></adf-dynamic-component>
                                    </ng-container>
                                    <ng-container *ngSwitchDefault>
                                        <ng-container *contezzaLet="element | materialTableCellProperty: column.key:column.type:column.format as cellValue">
                                            <span title="{{ cellValue }}">
                                                {{ cellValue }}
                                            </span>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-content></ng-content>

                    <ng-container *ngIf="actions">
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef class="contezza-material-table-container-column">
                                <span>{{ 'APP.COLUMNS.ACTIONS' | translate }}</span>
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <contezza-material-table-actions-column
                                    [data]="{ element: element, columns: columns, actions: actions }"
                                    (menuTriggert)="onActionMenuTriggert.emit($event)"
                                >
                                </contezza-material-table-actions-column>
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container *ngIf="expandedContent">
                        <ng-container matColumnDef="expandedDetail">
                            <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                                <div class="expanded-details" [@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'">
                                    <adf-dynamic-component
                                        [data]="getElementData(element, columns, actions, _dataSource.filteredData)"
                                        [id]="expandedComponentId"
                                    ></adf-dynamic-component>
                                </div>
                            </td>
                        </ng-container>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns"
                        class="contezza-material-table-container-column-row"
                        (click)="setSelection(row)"
                        [class.contezza-mat-table-hovered]="expandedElement === row"
                        [ngClass]="{ 'contezza-mat-table-hovered': row.hovered || row === expandedElement, 'contezza-mat-table-highlighted': selection.isSelected(row) }"
                        (mouseover)="row.hovered = true"
                        (mouseout)="row.hovered = false"
                    ></tr>
                    <ng-container *ngIf="expandedContent">
                        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="contezza-material-table-detail-row"></tr>
                    </ng-container>
                </table>
            </ng-container>
        </ng-container>
    </div>
    <div class="contezza-material-table-paging" *ngIf="showPaging" [ngClass]="loading || _dataSource?.data?.length === 0 ? 'hidden' : ''">
        <mat-paginator
            color="primary"
            [length]="_dataSource?.data?.length"
            [pageSize]="paginatorSettings?.pageSize"
            [pageSizeOptions]="[5, 10, 15, 20, 50]"
            [hidePageSize]="isSmallScreen"
            (page)="onPageChange($event)"
        ></mat-paginator>
    </div>
</div>
<ng-template #noResults>
    <div class="contezza-material-table-empty">
        <adf-custom-empty-content-template style="width: 100%">
            <adf-empty-content [icon]="emptyContent?.icon" [title]="emptyContent?.title | translate" [subtitle]="emptyContent?.subtitle | translate"></adf-empty-content>
        </adf-custom-empty-content-template>
    </div>
</ng-template>

<ng-template #loadingResults>
    <div class="contezza-material-table-loading">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>
